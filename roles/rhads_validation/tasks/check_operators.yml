---
- name: Initialize operators validation
  ansible.builtin.set_fact:
    operators_validation:
      status: "healthy"
      checked: 0
      healthy: 0
      degraded: 0
      failed: 0
      details: []

- name: Check each operator
  ansible.builtin.include_tasks: check_operator_single.yml
  loop: "{{ rhpds_build_secured_dev_workflows_rhads_validation_operators }}"
  loop_control:
    loop_var: operator

- name: Determine overall operators health
  ansible.builtin.set_fact:
    operators_validation: "{{ operators_validation | combine({
      'status': 'failed' if operators_validation.failed > 0
                else 'degraded' if operators_validation.degraded > 0
                else 'healthy'
    }) }}"

- name: Update overall validation results for operators
  ansible.builtin.set_fact:
    rhads_validation_results: "{{ rhads_validation_results | combine({
      'components': rhads_validation_results.components | combine({
        'operators': operators_validation
      }),
      'summary': {
        'total_components': rhads_validation_results.summary.total_components + operators_validation.checked,
        'healthy': rhads_validation_results.summary.healthy + operators_validation.healthy,
        'degraded': rhads_validation_results.summary.degraded + operators_validation.degraded,
        'failed': rhads_validation_results.summary.failed + operators_validation.failed
      }
    }) }}"
