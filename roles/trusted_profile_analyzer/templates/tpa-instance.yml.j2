apiVersion: rhtpa.io/v1
kind: TrustedProfileAnalyzer
metadata:
  name: trustedprofileanalyzer
spec:
  tracing:
    enabled: false
  metrics:
    enabled: false
  infrastructure:
    port: 9010
  rust:
    backtrace: true
    logFilter: debug
  appDomain: '-{{ rhpds_build_secured_dev_workflows_trusted_profile_analyzer_namespace }}.{{ openshift_cluster_ingress_domain }}'
  migrateDatabase:
    host:
      valueFrom:
        secretKeyRef:
          key: host
          name: tpa-pgsql-user
    name:
      valueFrom:
        secretKeyRef:
          key: dbname
          name: tpa-pgsql-user
    password:
      valueFrom:
        secretKeyRef:
          key: password
          name: tpa-pgsql-user
    port:
      valueFrom:
        secretKeyRef:
          key: port
          name: tpa-pgsql-user
    username:
      valueFrom:
        secretKeyRef:
          key: user
          name: tpa-pgsql-user
  modules:
    createDatabase:
      enabled: true
    createImporters:
      enabled: true
      importers:
        cve:
          cve:
            description: CVE list v5
            disabled: false
            period: 1d
            source: 'https://github.com/CVEProject/cvelistV5'
        osv-github:
          osv:
            description: GitHub Advisory Database
            disabled: false
            path: advisories
            period: 1d
            source: 'https://github.com/github/advisory-database'
        redhat-csaf:
          csaf:
            description: All Red Hat CSAF data
            disabled: true
            fetchRetries: 50
            period: 1d
            source: redhat.com
        redhat-sboms:
          sbom:
            description: All Red Hat SBOMs
            disabled: true
            fetchRetries: 50
            keys:
              - 'https://access.redhat.com/security/data/97f5eac4.txt#77E79ABE93673533ED09EBE2DCE3823597F5EAC4'
            period: 1d
            source: 'https://access.redhat.com/security/data/sbom/beta/'
    migrateDatabase:
      enabled: true
    server:
      enabled: true
      tracing: {}
      metrics: {}
      infrastructure: {}
      rust: {}
      resources:
        requests:
          cpu: 1
          memory: 8Gi
      ingress: {}
      image: {}
      replicas: 1
  partOf: trustify
  collector: {}
  ingress:
    className: openshift-default
  createDatabase:
    host:
      valueFrom:
        secretKeyRef:
          key: host
          name: tpa-pgsql-user
    name:
      valueFrom:
        secretKeyRef:
          key: dbname
          name: tpa-pgsql-user
    password:
      valueFrom:
        secretKeyRef:
          key: password
          name: tpa-pgsql-user
    port:
      valueFrom:
        secretKeyRef:
          key: port
          name: tpa-pgsql-user
    username:
      valueFrom:
        secretKeyRef:
          key: user
          name: tpa-pgsql-user
  openshift:
    useServiceCa: true
  oidc:
    clients:
      cli:
        clientId: ${TPA_CLI_CLIENT_ID}
        clientSecret:
          valueFrom:
            secretKeyRef:
              key: ${TPA_CLI_CLIENT_ID}
              name: tpa-realm-${TPA_CLI_CLIENT_ID}-clients
      frontend:
        clientId: frontend
    issuerUrl: 'https://sso.{{ openshift_cluster_ingress_domain }}/realms/{{ rhpds_build_secured_dev_workflows_trusted_profile_analyzer_keycloak_realm }}'
  tls:
    additionalTrustAnchor: /var/run/secrets/kubernetes.io/serviceaccount/ca.crt
    serviceEnabled: true
  database:
    host:
      valueFrom:
        secretKeyRef:
          key: host
          name: tpa-pgsql-user
    name:
      valueFrom:
        secretKeyRef:
          key: dbname
          name: tpa-pgsql-user
    password:
      valueFrom:
        secretKeyRef:
          key: password
          name: tpa-pgsql-user
    port:
      valueFrom:
        secretKeyRef:
          key: port
          name: tpa-pgsql-user
    sslMode: disable
    username:
      valueFrom:
        secretKeyRef:
          key: user
          name: tpa-pgsql-user
  storage:
    size: 32Gi
    type: filesystem
  replicas: 1