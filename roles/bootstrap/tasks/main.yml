---
- block:
  - name: Create kubeconfig
    ansible.builtin.shell: |
      oc login --token {{ rhpds_build_secured_dev_workflows_bootstrap_openshift_cluster_admin_token }} {{
      rhpds_build_secured_dev_workflows_bootstrap_openshift_api_url }} --insecure-skip-tls-verify

  - name: Create a  directory for lab assets
    ansible.builtin.file:
      path: /home/{{ student_name }}/lab-assets
      state: directory
      mode: '0755'
  delegate_to: bastion

- name: Create TSSC namespaces
  kubernetes.core.k8s:
    state: present
    api_version: v1
    kind: Namespace
    name: "{{ item }}"
  loop:
  - tssc-app-ci
  - tssc-app-development
  - tssc-app-stage
  - tssc-app-prod

- name: Setup Quay
  ansible.builtin.include_tasks:
    file: ./setup_quay.yml