---
- block:
  - name: Create kubeconfig
    ansible.builtin.shell: |
      oc login --token {{ openshift_cluster_admin_token }} {{
      openshift_api_url }} --insecure-skip-tls-verify

  - name: Create a  directory for lab assets
    ansible.builtin.file:
      path: /home/{{ student_name }}/lab-assets
      state: directory
      mode: '0755'
  delegate_to: bastion

- name: Create tssc namespaces
  kubernetes.core.k8s:
    state: present
    definition:
      apiVersion: v1
      kind: Namespace
      metadata:
        name: "{{ item }}"
  loop:
  - tssc-tas
  - tssc-app-ci
  - tssc-app-development
  - tssc-app-prod

- name: Patch StorageCluster resources
  kubernetes.core.k8s:
    name: ocs-external-storagecluster
    namespace: openshift-storage
    state: present
    definition: "{{ rhpds_build_secured_dev_workflows_bootstrap_storagecluster_resources }}"