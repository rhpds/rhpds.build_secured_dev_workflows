---
- block:
  - name: Create kubeconfig
    ansible.builtin.shell: |
      oc login --token {{ openshift_cluster_admin_token }} {{
      openshift_api_url }} --insecure-skip-tls-verify

  - name: Create a  directory for lab assets
    ansible.builtin.file:
      path: /home/{{ student_name }}/lab-assets
      state: directory
      mode: '0755'
  delegate_to: bastion

- name: Create tssc namespaces
  kubernetes.core.k8s:
    state: present
    definition:
      apiVersion: v1
      kind: Namespace
      metadata:
        name: "{{ item }}"
  loop:
  - tssc-tas
  - tssc-app-ci
  - tssc-app-development
  - tssc-app-stage
  - tssc-app-prod

- name: Propogate showroom bastion information
  ansible.builtin.set_fact:
    bastion_ssh_command: "ssh {{ bastion_ansible_user }}@{{ bastion_ansible_host }} -p {{ bastion_ansible_port }}"
    bastion_public_hostname: "{{ bastion_ansible_host }}"
    bastion_ssh_user_name: "{{ bastion_ansible_user }}"
    bastion_ssh_password: "{{ bastion_ansible_ssh_pass }}"